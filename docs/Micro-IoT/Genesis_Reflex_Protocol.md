# Genesis Core: Hardware Reflex Layer Protocol (v1.0)

## üì° Overview
This document defines the communication standard between **Genesis Core (AI)** and the **Physical Robot Body (ESP32)**. The goal is to separate "Instincts" (Reflexes) from "Thoughts" (AI Decisions).

- **Protocol**: Socket.IO (v4.x) over WiFi
- **Transport**: Websockets (Preferred) / Polling
- **Authentication**: `token` query parameter or Auth Object

## üîê Connection Handshake
**Endpoint**: `http://<GENESIS_IP>:8000`
**Auth**: Must provide `GHOST_SECRET` (Default: `GHOST_99_ALPHA`)

### Example Connection (Arduino/C++)
```cpp
socket.begin("192.168.1.X", 8000, "/socket.io/?transport=websocket&token=GHOST_99_ALPHA");
```

---

## üì§ Outgoing Events (ESP32 -> Genesis)

### 1. `telemetry` (Heartbeat)
Sent every 2-5 seconds to update status.
```json
{
  "dashboard_id": "8",         // Identity
  "battery": 85,               // Percentage (Affects AI Energy)
  "wifi_signal": -60,          // dBm
  "status": "IDLE"             // RAW Status
}
```
*Effect*: Updates the dashboard and AI internal cognitive state (Energy).

### 2. `reflex` (Immediate Stimulus)
Sent **immediately** when a sensor threshold is crossed (e.g., obstacle < 30cm).
```json
{
  "dashboard_id": "8",
  "reflex": "OBSTACLE_DETECTED", // Type of stimulus
  "sensor": "ULTRASONIC_FRONT",
  "distance": 15,                // Value triggering reflex
  "action_taken": "STOP"         // Autonomous action taken by ESP32 (if any)
}
```
*Effect*: 
- Wakes AI from Sleep Mode `[ZZZ]`.
- Sets Mood to `ALERT`.
- Triggers immediate "Reflex Log" in Hub.

---

## üì• Incoming Events (Genesis -> ESP32)

### 1. `robot_command` (AI Will)
Commands generated by the LLM based on high-level reasoning.
```json
{
  "action": "FORWARD",  // FORWARD, BACKWARD, LEFT, RIGHT, STOP, SCAN
  "speed": 200,         // 0-255 (Optional)
  "duration": 1000      // ms (Optional)
}
```

### 2. `set_state` (Force State)
Used to override hardware settings.
```json
{
  "mode": "STEALTH",    // NORMAL, STEALTH, TURBO
  "led_color": "#ff0000"
}
```

---

## ‚ö° Energy & Sleep Logic
- **Battery < 10%**: ESP32 slows down telemetry to save power.
- **Genesis Sleep [ZZZ]**: ESP32 continues normal operation but knows AI is offline.
- **Wake Up**: Any `reflex` event sent by ESP32 will force-wake the Genesis Core.
